
## With R 3.1.0 or later, you can uncomment the following line to tell R to 
## enable compilation with C++11 (where available)
##
## Also, OpenMP support in Armadillo prefers C++11 support. However, for wider
## availability of the package we do not yet enforce this here.  It is however
## recommended for client packages to set it.
##
## And with R 3.4.0, and RcppArmadillo 0.7.960.*, we turn C++11 on as OpenMP
## support within Armadillo prefers / requires it


VERSION=1.2

PLATFORM:=$(shell echo $$OSTYPE)

$(info )
ifndef PATH_TO_libSQUIC
PATH_TO_libSQUIC:=${HOME}
$(error ## Environment variable PATH_TO_libSQUIC is not set. Default PATH_TO_libSQUIC=${PATH_TO_libSQUIC}. Use e.g., Sys.setenv(PATH_TO_libSQUIC="~/Other") to change. ##)
endif
$(info ## PATH_TO_libSQUIC=${PATH_TO_libSQUIC} ##)
$(info )

$(info )
# Get filename
FILE_libSQUIC:=
ifneq (,$(findstring darwin,$(PLATFORM)))
 FILE_libSQUIC:=libSQUIC.dylib
 $(info	## ${PLATFORM} (MAC) detected - expecting SQUIC shared library ${FILE_libSQUIC} at ${PATH_TO_libSQUIC} ##)
else ifneq (,$(findstring linux,$(PLATFORM)))	
 FILE_libSQUIC:=libSQUIC.so
 $(info	## ${PLATFORM} (Linux) detected - expecting SQUIC shared library ${FILE_libSQUIC} at ${PATH_TO_libSQUIC} ##)
else ifneq (,$(findstring windows,$(PLATFORM)))
 FILE_libSQUIC:=libSQUIC.dll
 $(info	## ${PLATFORM} (Windows) detected - expecting SQUIC shared library ${FILE_libSQUIC} at ${PATH_TO_libSQUIC} ##)
else
 $(error ## Platform not detected! ##)
endif
$(info )

FILE_PATH_TO_libSQUIC:=${PATH_TO_libSQUIC}/${FILE_libSQUIC}

$(info )
# check if file exists
ifneq ("$(wildcard $(FILE_PATH_TO_libSQUIC) )","")
 $(info	## ${FILE_PATH_TO_libSQUIC} found ! <<)
else
 $(error ## ${FILE_PATH_TO_libSQUIC} not found. ##)
endif
$(info )

CXX_STD = CXX11
PKG_CXXFLAGS =-O3 # will defualt back to -O2
PKG_LIBS = -L${PATH_TO_libSQUIC} -lSQUIC 
PKG_CPPFLAGS = -DARMA_64BIT_WORD=1

all: $(SHLIB)
	@if command -v install_name_tool; then install_name_tool -change libSQUIC.dylib ${PATH_TO_libSQUIC}/libSQUIC.dylib $(SHLIB); fi


